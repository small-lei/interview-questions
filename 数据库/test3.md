# MySQL索引为什么要用B+树?

MySQL 索引使用 B+ 树的原因主要与 B+ 树的结构特点和数据库系统的访问需求有关。下面详细介绍为什么 MySQL 中使用 B+ 树作为索引结构。

## B+ 树的基本特点
   B+ 树是一种平衡树，是 B 树的变种。与 B 树不同的是，B+ 树的所有数据都存储在叶子节点，非叶子节点只存储键值用于索引。B+ 树具备以下特点：

多路平衡：B+ 树是一棵平衡的多路搜索树，保证所有叶子节点的深度相同，避免了极端情况的链表式退化。
叶子节点的链表结构：B+ 树的叶子节点通过指针相连，形成一个链表结构，便于范围查询和遍历操作。
磁盘友好：B+ 树节点中可以存储多个键，每次 IO 操作读取一个节点，可以更高效地利用磁盘块读取，从而减少磁盘 IO 次数。
## MySQL 使用 B+ 树作为索引的优势
  ### 磁盘 IO 访问效率高
   数据库中索引的主要作用是加快查找速度，而数据库的数据往往比内存大，因此需要将索引存储在磁盘中。磁盘的随机读写非常耗时，因此需要减少 IO 次数。
   B+ 树中的每个节点都可以存储多个数据（与 B 树类似），因此每次读取一个节点，可以得到多个键值，降低了磁盘访问的次数。
   B+ 树的叶子节点形成链表，适合顺序扫描和范围查询，通过顺序读写的方式访问磁盘更加高效。

### 适合范围查询
B+ 树的叶子节点按键值从小到大排序，并且通过指针相连。因此，B+ 树天然适合范围查询。当需要查找某个区间范围内的所有数据时，找到范围的起点后，只需沿着叶子节点链表遍历，直至到达范围终点即可。这种结构极大地优化了范围查询的性能。

相较之下，B 树的每个节点中不仅存储键值，还存储数据。当进行范围查询时，必须逐一遍历树中所有节点，效率较低。

### 数据更新性能高
数据库中的数据插入、删除和更新都是常见操作，B+ 树结构非常适合这类动态操作：

插入与删除：B+ 树始终保持平衡，插入或删除操作在 B+ 树中只需要对少量的节点进行局部调整，不会影响整棵树的结构。相比其他树结构，如二叉树，B+ 树能更好地控制树的高度，从而保证更新操作的效率。

维护代价低：由于 B+ 树是平衡树，每次插入和删除都可以在 O(log n) 时间复杂度内完成。而在数据量很大的情况下，其他非平衡结构可能需要大量的重构操作。

### 支持高并发
B+ 树的多路性使得其在数据库中可以较好地支持并发操作。数据库系统需要处理多个用户的读写请求，而 B+ 树可以通过锁粒度控制，在高并发场景下提供较好的性能表现。

## 为什么不用 B 树、红黑树或哈希表
   B 树：B 树和 B+ 树的最大区别在于，B 树的非叶子节点也存储数据，这使得每次搜索操作不仅要查找索引，还可能需要访问中间节点的实际数据。而 B+ 树的所有数据都集中在叶子节点，可以更方便地进行范围查询和顺序遍历。

  红黑树：红黑树是二叉平衡树的一种，它的特点是操作简单、效率高，查找、插入和删除的时间复杂度为 O(log n)。但红黑树的高度相对较大（因为是二叉树），在数据量非常大的情况下，每次查询的磁盘 IO 次数较多。而 B+ 树是多路树，高度相对较低，能更好地减少磁盘访问次数。

  哈希表：哈希表查找的时间复杂度为 O(1)，非常适合精确查找，但它不适合范围查询，因为哈希函数会打乱数据的顺序。哈希索引无法直接支持范围查询、排序、最小值等操作。而 B+ 树天然支持这些操作，特别是在电商系统中，范围查询、价格区间过滤等需求非常常见。

## B+ 树的缺点
   不适合频繁的写操作：尽管 B+ 树在插入和删除操作上表现不错，但对于频繁的写操作场景，B+ 树可能不是最优的结构，因为频繁的插入和删除会导致节点的分裂和合并，带来较高的开销。

维护成本高：B+ 树需要额外维护父节点、子节点、兄弟节点等指针，管理起来相对复杂。

## 总结
  MySQL 选择 B+ 树作为索引结构，主要是因为其在磁盘 IO 性能、范围查询和顺序遍历上的优势。与其他数据结构相比，B+ 树能够很好地适应数据库系统中高效查找、更新和并发访问的需求，特别是当数据量非常大时，B+ 树的性能优势尤为明显。